<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<style>
    :root {
        font-family: 'Roboto Slab', serif;
        font-style: normal;
        font-weight: normal;
        --tg-theme-bg-color: #17212B;
        --tg-theme-text-color: #D1F2F0;
        --tg-theme-hint-color: #556C80;
        --tg-theme-link-color: #6BBFFF;
        --tg-theme-button-color: #2B5278;
        --tg-theme-button-text-color: white;
        --tg-theme-secondary-bg-color: #0E1621;
    }

    body {
        overflow-x: hidden;
        overflow-y: scroll;
        padding: 0;
        margin: 0;
        background: var(--tg-theme-secondary-bg-color);
    }

    .container {
        margin: 0 auto;
        width: min(100vw, 100vh);
    }

    .grid-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        padding: min(1vh, 1vw);
        width: calc(100% - min(2vh, 2vw));
    }

    .grid-item {
        overflow: hidden;
        padding: min(1vh, 1vw);
        font-size: 30px;
        text-align: center;
        overflow-wrap: break-word;
    }

    .subject {
        width: 100%;
        margin: 0 auto;
        height: min(26vw, 26vh);
        background: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
        font-size: min(3vw, 3vh);
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        transition-duration: 0.4s;
        border-radius: min(3vw, 3vh);
        vertical-align: middle;
        padding: min(4vw, 4vh);
        border-width: 0;
    }

    .subject.added {
        background: var(--tg-theme-button-color);
    }

    .delete-all {
        position: fixed;
        margin: 0 min(2vw, 2vh);
        top: min(2vw, 2vh);
        width: min(96vw, 96vh);
        border: 0;
        background: #e01717;
        color: white;
        border-radius: min(5vw, 5vh);
        height: min(16vw, 16vh);
        font-size: min(3vw, 3vh);
    }
</style>
<body>
<div class="container">
    <button class="delete-all" onclick="delete_all()" id="delete-all"><b>Очистить</b></button>
<div class="grid-container" id="grid-container">
    <div class="grid-item">
        <button class="subject" onclick="button_click(1)" id='1'>Английский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(2)" id='2'>Китайский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(3)" id='3'>Робототехника</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(4)" id='4'>Арабский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(5)" id='5'>Лингвистика</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(6)" id='6'>Русский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(7)" id='7'>Астрономия</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(8)" id='8'>Литература</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(9)" id='9'>Технология</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(10)" id='10'>Биология</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(11)" id='11'>Математика</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(12)" id='12'>Физика</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(13)" id='13'>География</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(14)" id='14'>Менеджмент</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(15)" id='15'>Физическая культура</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(16)" id='16'>ИЗО</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(17)" id='17'>Немецкий язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(18)" id='18'>Французский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(19)" id='19'>Информатика</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(20)" id='20'>ОБЖ</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(21)" id='21'>Химия</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(22)" id='22'>Искусство</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(23)" id='23'>Обществознание</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(24)" id='24'>Черчение</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(25)" id='25'>Испанский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(26)" id='26'>Основы предпринимательства</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(27)" id='27'>Экология</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(28)" id='28'>История</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(29)" id='29'>Право</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(30)" id='30'>Экономика</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(31)" id='31'>Итальянский язык</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(32)" id='32'>Психология</button>
    </div>
    <div class="grid-item">
        <button class="subject" onclick="button_click(33)" id='33'>Японский язык</button>
    </div>
</div>
</div>
</body>
<script type="application/javascript">
    let chosen_count = 0;

    function check_chosen() {
        let button = document.getElementById("delete-all");
        let grid_container = document.getElementById("grid-container");
        if (chosen_count === 0) {
            button.style.display = "none";
            grid_container.style.marginTop = "0";
        } else {
            button.style.display = "";
            grid_container.style.marginTop = "min(20vw, 20vh)";
        }
    }

    function button_click(button_id) {
        let button = document.getElementById(button_id);
        if (button.classList.contains("added")) {
            button.classList.remove("added");
            chosen_count -= 1;
        } else {
            button.classList.add("added");
            chosen_count += 1;
        }
        check_chosen();
    }

    function delete_all() {
        let buttons = document.getElementsByClassName("subject");
        for (let i = 0; i < buttons.length; i += 1) {
            let button = buttons[i];
            if (button.classList.contains("added")) {
                button.classList.remove("added");
            }
        }
        chosen_count = 0;
        check_chosen();
    }

    {% for subject in subjects %}
    button_click('{{ subject }}');
    {% endfor %}
    check_chosen();

    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.color = "#0dbb00";
    tg.MainButton.text = "Сохранить";
    tg.MainButton.show();
    tg.onEvent('mainButtonClicked', function(){
        let chosen_subjects = [];
        let buttons = document.getElementsByClassName("subject");
        for (let i = 0; i < buttons.length; i += 1) {
            let button = buttons[i];
            if (button.classList.contains("added")) {
                chosen_subjects.push(button.innerText);
            }
        }
        let data = {
            subjects: chosen_subjects
        }
        tg.sendData(JSON.stringify(data));
    });
</script>
</html>
